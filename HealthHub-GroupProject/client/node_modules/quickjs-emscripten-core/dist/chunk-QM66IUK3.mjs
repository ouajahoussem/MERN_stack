import{a as d,b as p,g as s,j as f,m as y,n as S,o as k,p as J,r as Q,s as v,t as A}from"./chunk-TEPNWHZX.mjs";var u=class extends k{async evalCodeAsync(n,e="eval.js",t){let o=t===void 0?1:0,i=S(t),r=0;try{r=await this.memory.newHeapCharPointer(n).consume(c=>this.ffi.QTS_Eval_MaybeAsync(this.ctx.value,c.value.ptr,c.value.strlen,e,o,i))}catch(c){throw d("QTS_Eval_MaybeAsync threw",c),c}let a=this.ffi.QTS_ResolveException(this.ctx.value,r);return a?(this.ffi.QTS_FreeValuePointer(this.ctx.value,r),{error:this.memory.heapValueHandle(a)}):{value:this.memory.heapValueHandle(r)}}newAsyncifiedFunction(n,e){return this.newFunction(n,e)}};var l=class extends J{constructor(n){super(n)}newContext(n={}){let e=y(n.intrinsics),t=new s(this.ffi.QTS_NewContext(this.rt.value,e),void 0,i=>{this.contextMap.delete(i),this.callbacks.deleteContext(i),this.ffi.QTS_FreeContext(i)}),o=new u({module:this.module,ctx:t,ffi:this.ffi,rt:this.rt,ownedLifetimes:[],runtime:this,callbacks:this.callbacks});return this.contextMap.set(t.value,o),o}setModuleLoader(n,e){super.setModuleLoader(n,e)}setMaxStackSize(n){return super.setMaxStackSize(n)}};var M=class extends A{constructor(e,t){super(e,t);this.ffi=t,this.module=e}newRuntime(e={}){let t=new s(this.ffi.QTS_NewRuntime(),void 0,i=>{this.callbacks.deleteRuntime(i),this.ffi.QTS_FreeRuntime(i)}),o=new l({module:this.module,ffi:this.ffi,rt:t,callbacks:this.callbacks});return Q(o,e),e.moduleLoader&&o.setModuleLoader(e.moduleLoader),o}newContext(e={}){let t=this.newRuntime(),o=e.ownedLifetimes?e.ownedLifetimes.concat([t]):[t],i=t.newContext({...e,ownedLifetimes:o});return t.context=i,i}evalCode(){throw new p("QuickJSWASMModuleAsyncify.evalCode: use evalCodeAsync instead")}evalCodeAsync(e,t){return f.withScopeAsync(async o=>{let i=o.manage(this.newContext());v(i.runtime,t);let r=await i.evalCodeAsync(e,"eval.js");if(t.memoryLimitBytes!==void 0&&i.runtime.setMemoryLimit(-1),r.error)throw i.dump(o.manage(r.error));return i.dump(o.manage(r.value))})}};export{u as a,l as b,M as c};
//# sourceMappingURL=chunk-QM66IUK3.mjs.map