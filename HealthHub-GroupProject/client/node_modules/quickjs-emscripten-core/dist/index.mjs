import{a as O,b as A,c as Q}from"./chunk-QM66IUK3.mjs";import{a as M,c as w,d as y,e as F,f as b,g as V,h as W,i as P,j as T,k as C,l as L,o as g,p as h,t as H}from"./chunk-TEPNWHZX.mjs";export*from"@jitl/quickjs-ffi-types";async function E(t){let e=l(await t),[r,u,{QuickJSWASMModule:p}]=await Promise.all([e.importModuleLoader().then(l),e.importFFI(),import("./module-HMQCEAUF.mjs").then(l)]),o=await r();o.type="sync";let s=new u(o);return new p(o,s)}async function I(t){let e=l(await t),[r,u,{QuickJSAsyncWASMModule:p}]=await Promise.all([e.importModuleLoader().then(l),e.importFFI(),import("./module-asyncify-E5AWDY4G.mjs").then(l)]),o=await r();o.type="async";let s=new u(o);return new p(o,s)}function z(t){let e;return()=>e??(e=t())}function l(t){return t&&"default"in t&&t.default?t.default&&"default"in t.default&&t.default.default?t.default.default:t.default:t}function N(t,e){return{...t,async importModuleLoader(){let u=l(await t.importModuleLoader());return async function(){let o=e.emscriptenModule?{...e.emscriptenModule}:{},s=e.log??((...n)=>M("newVariant moduleLoader:",...n)),d=(n,i)=>(s(...n,i),i),c=n=>typeof n=="function"?n():n;(e.wasmLocation||e.wasmSourceMapLocation||e.locateFile)&&(o.locateFile=(n,i)=>{let a={fileName:n,relativeTo:i};if(n.endsWith(".wasm")&&e.wasmLocation!==void 0)return d(["locateFile .wasm: provide wasmLocation",a],e.wasmLocation);if(n.endsWith(".map")){if(e.wasmSourceMapLocation!==void 0)return d(["locateFile .map: provide wasmSourceMapLocation",a],e.wasmSourceMapLocation);if(e.wasmLocation&&!e.locateFile)return d(["locateFile .map: infer from wasmLocation",a],e.wasmLocation+".map")}return e.locateFile?d(["locateFile: use provided fn",a],e.locateFile(n,i)):d(["locateFile: unhandled, passthrough",a],n)}),e.wasmBinary&&(o.wasmBinary=await c(e.wasmBinary)),e.wasmMemory&&(o.wasmMemory=await c(e.wasmMemory));let f=e.wasmModule,S;f&&(o.instantiateWasm=async(n,i)=>{S??(S=Promise.resolve(c(f)));let a=await S;if(!a)throw new y(`options.wasmModule returned ${String(a)}`);let x=await WebAssembly.instantiate(a,n);return i(x),x.exports}),o.monitorRunDependencies=n=>{s("monitorRunDependencies:",n)},o.quickjsEmscriptenInit=()=>v(s);let J=u(o),m=o.quickjsEmscriptenInit?.(s);if(f&&m?.receiveWasmOffsetConverter&&!m.existingWasmOffsetConverter){let n=await c(e.wasmBinary)??new ArrayBuffer(0);S??(S=Promise.resolve(c(f)));let i=await S;if(!i)throw new y(`options.wasmModule returned ${String(i)}`);m.receiveWasmOffsetConverter(n,i)}if(m?.receiveSourceMapJSON){let n=await c(e.wasmSourceMapData);typeof n=="string"?m.receiveSourceMapJSON(JSON.parse(n)):n?m.receiveSourceMapJSON(n):m.receiveSourceMapJSON({version:3,names:[],sources:[],mappings:""})}return J}}}}function v(t){let e="mock called, emscripten module may not be initialized yet";return{mock:!0,removeRunDependency(r){t(`${e}: removeRunDependency called:`,r)},receiveSourceMapJSON(r){t(`${e}: receiveSourceMapJSON called:`,r)},WasmOffsetConverter:void 0,receiveWasmOffsetConverter(r,u){t(`${e}: receiveWasmOffsetConverter called:`,r,u)}}}function j(t){return!("error"in t)}function $(t){return"error"in t}function K(t){let e=typeof t=="number"?t:t.getTime();return function(){return Date.now()>e}}var k=class{constructor(e){this.parent=e;this.contexts=new Set;this.runtimes=new Set}newRuntime(e){let r=this.parent.newRuntime({...e,ownedLifetimes:[new V(void 0,void 0,()=>this.runtimes.delete(r)),...e?.ownedLifetimes??[]]});return this.runtimes.add(r),r}newContext(e){let r=this.parent.newContext({...e,ownedLifetimes:[new V(void 0,void 0,()=>this.contexts.delete(r)),...e?.ownedLifetimes??[]]});return this.contexts.add(r),r}evalCode(e,r){return this.parent.evalCode(e,r)}disposeAll(){let e=[...this.contexts,...this.runtimes];this.runtimes.clear(),this.contexts.clear(),e.forEach(r=>{r.alive&&r.dispose()})}assertNoMemoryAllocated(){if(this.getFFI().QTS_RecoverableLeakCheck())throw new w("Leak sanitizer detected un-freed memory");if(this.contexts.size>0)throw new w(`${this.contexts.size} contexts leaked`);if(this.runtimes.size>0)throw new w(`${this.runtimes.size} runtimes leaked`)}getWasmMemory(){return this.parent.getWasmMemory()}getFFI(){return this.parent.getFFI()}};export{L as DefaultIntrinsics,V as Lifetime,O as QuickJSAsyncContext,A as QuickJSAsyncRuntime,Q as QuickJSAsyncWASMModule,g as QuickJSContext,C as QuickJSDeferredPromise,h as QuickJSRuntime,H as QuickJSWASMModule,T as Scope,W as StaticLifetime,k as TestQuickJSWASMModule,b as UsingDisposable,P as WeakLifetime,M as debugLog,F as errors,$ as isFail,j as isSuccess,z as memoizePromiseFactory,I as newQuickJSAsyncWASMModuleFromVariant,E as newQuickJSWASMModuleFromVariant,N as newVariant,K as shouldInterruptAfterDeadline};
//# sourceMappingURL=index.mjs.map